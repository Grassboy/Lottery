var PokemonGoMouseGesture = [[{"previous_time":1482401725655,"x":514,"y":115,"ball_pos":{"x":0,"y":3.0799316114381443,"z":3.626585899430636e-15}},{"x":516,"y":117,"ms":66},{"x":520,"y":128,"ms":30},{"x":526,"y":137,"ms":21},{"x":538,"y":154,"ms":23},{"x":552,"y":177,"ms":24},{"x":561,"y":193,"ms":22},{"x":565,"y":203,"ms":26},{"x":565,"y":211,"ms":26},{"x":565,"y":214,"ms":1},{"x":565,"y":216,"ms":18},{"x":565,"y":221,"ms":22},{"x":565,"y":222,"ms":22},{"x":564,"y":226,"ms":10},{"x":564,"y":228,"ms":23},{"x":563,"y":229,"ms":1},{"x":561,"y":235,"ms":27},{"x":557,"y":241,"ms":34},{"x":555,"y":244,"ms":25},{"x":554,"y":247,"ms":11},{"x":553,"y":248,"ms":23},{"x":553,"y":250,"ms":23},{"x":552,"y":251,"ms":34},{"x":551,"y":252,"ms":26},{"x":550,"y":252,"ms":64},{"x":549,"y":253,"ms":44},{"x":548,"y":253,"ms":30},{"x":547,"y":253,"ms":188},{"x":546,"y":253,"ms":25},{"x":545,"y":253,"ms":123},{"x":544,"y":253,"ms":24},{"x":543,"y":253,"ms":26},{"x":542,"y":253,"ms":25},{"x":540,"y":253,"ms":92},{"x":538,"y":253,"ms":22},{"x":537,"y":253,"ms":8},{"x":531,"y":253,"ms":26},{"x":512,"y":254,"ms":26},{"x":486,"y":254,"ms":10},{"x":423,"y":257,"ms":25},{"x":369,"y":257,"ms":21},{"x":346,"y":257,"ms":9},{"x":284,"y":250,"ms":26},{"x":276,"y":243,"ms":26},{"x":276,"y":240,"ms":9},{"x":303,"y":222,"ms":24},{"x":397,"y":187,"ms":22},{"x":435,"y":173,"ms":8},{"x":561,"y":138,"ms":29},{"x":578,"y":134,"ms":1},{"x":647,"y":128,"ms":29},{"x":654,"y":128,"ms":10},{"x":674,"y":141,"ms":22},{"x":688,"y":174,"ms":20},{"x":690,"y":184,"ms":9},{"x":694,"y":203,"ms":21},{"x":696,"y":211,"ms":1},{"x":697,"y":223,"ms":20},{"x":697,"y":231,"ms":6},{"x":694,"y":236,"ms":9},{"x":671,"y":258,"ms":23},{"x":620,"y":281,"ms":23},{"x":536,"y":304,"ms":27},{"x":448,"y":312,"ms":22},{"x":386,"y":303,"ms":20},{"x":321,"y":268,"ms":22},{"x":304,"y":251,"ms":3},{"x":294,"y":238,"ms":9},{"x":285,"y":212,"ms":21},{"x":285,"y":199,"ms":7},{"x":307,"y":157,"ms":27},{"x":343,"y":133,"ms":25},{"x":380,"y":117,"ms":18},{"x":424,"y":101,"ms":19},{"x":471,"y":95,"ms":21},{"x":534,"y":101,"ms":21},{"x":599,"y":120,"ms":20},{"x":693,"y":155,"ms":20},{"x":789,"y":242,"ms":60},{"x":776,"y":279,"ms":22},{"x":729,"y":326,"ms":26},{"x":664,"y":360,"ms":23},{"x":517,"y":377,"ms":22},{"x":362,"y":339,"ms":26},{"x":274,"y":280,"ms":20},{"x":266,"y":268,"ms":1},{"x":267,"y":226,"ms":27},{"x":326,"y":177,"ms":23},{"x":402,"y":143,"ms":21},{"x":426,"y":136,"ms":1},{"x":527,"y":111,"ms":23},{"x":682,"y":107,"ms":22},{"x":762,"y":142,"ms":27},{"x":708,"y":216,"ms":50},{"x":638,"y":229,"ms":21},{"x":596,"y":231,"ms":1},{"x":497,"y":227,"ms":24},{"x":485,"y":220,"ms":23},{"x":485,"y":216,"ms":1},{"x":527,"y":190,"ms":24},{"x":674,"y":157,"ms":27},{"x":673,"y":225,"ms":95},{"x":519,"y":223,"ms":22},{"x":429,"y":202,"ms":23},{"x":410,"y":190,"ms":1},{"x":403,"y":174,"ms":23},{"x":459,"y":149,"ms":27},{"x":605,"y":142,"ms":23},{"x":700,"y":143,"ms":25},{"x":688,"y":201,"ms":47},{"x":639,"y":242,"ms":25},{"x":551,"y":256,"ms":27},{"x":464,"y":234,"ms":24},{"x":455,"y":210,"ms":21},{"x":480,"y":192,"ms":20},{"x":586,"y":167,"ms":19},{"x":684,"y":165,"ms":22},{"x":700,"y":234,"ms":58},{"x":666,"y":258,"ms":18},{"x":595,"y":276,"ms":20},{"x":549,"y":276,"ms":4},{"x":445,"y":267,"ms":23},{"x":428,"y":256,"ms":21},{"x":427,"y":252,"ms":0},{"x":461,"y":230,"ms":26},{"x":526,"y":212,"ms":22},{"x":575,"y":200,"ms":1},{"x":652,"y":193,"ms":25},{"x":666,"y":208,"ms":25},{"x":648,"y":243,"ms":25},{"x":579,"y":269,"ms":22},{"x":466,"y":261,"ms":27},{"x":435,"y":243,"ms":23},{"x":459,"y":218,"ms":28},{"x":482,"y":210,"ms":0},{"x":566,"y":184,"ms":22},{"x":755,"y":129,"ms":45},{"x":756,"y":128,"ms":23},{"x":744,"y":125,"ms":27},{"x":719,"y":120,"ms":23},{"x":692,"y":111,"ms":22},{"x":657,"y":102,"ms":27},{"x":619,"y":102,"ms":27},{"x":602,"y":106,"ms":1},{"x":575,"y":120,"ms":22},{"x":527,"y":152,"ms":27},{"x":495,"y":172,"ms":22},{"x":476,"y":184,"ms":1},{"x":427,"y":214,"ms":19},{"x":388,"y":254,"ms":25},{"x":389,"y":266,"ms":21},{"x":395,"y":273,"ms":22},{"x":400,"y":276,"ms":0},{"x":420,"y":291,"ms":25},{"x":451,"y":305,"ms":20},{"x":592,"y":317,"ms":23},{"x":765,"y":295,"ms":22},{"x":832,"y":270,"ms":22},{"x":866,"y":250,"ms":1},{"x":927,"y":159,"ms":97},{"x":920,"y":146,"ms":22},{"x":914,"y":139,"ms":0},{"x":898,"y":128,"ms":21},{"x":867,"y":120,"ms":19},{"x":847,"y":119,"ms":1},{"x":789,"y":123,"ms":19},{"x":686,"y":151,"ms":21},{"x":625,"y":181,"ms":19},{"x":535,"y":237,"ms":25},{"x":477,"y":280,"ms":22},{"x":471,"y":297,"ms":24},{"x":473,"y":305,"ms":21},{"x":474,"y":308,"ms":1},{"x":477,"y":311,"ms":21},{"x":485,"y":320,"ms":27},{"x":512,"y":324,"ms":24},{"x":551,"y":318,"ms":21},{"x":613,"y":292,"ms":23},{"x":665,"y":278,"ms":22},{"x":680,"y":276,"ms":27},{"x":670,"y":290,"ms":39},{"x":599,"y":313,"ms":29},{"x":428,"y":316,"ms":42},{"x":415,"y":304,"ms":44},{"x":429,"y":292,"ms":1},{"x":628,"y":193,"ms":42},{"x":766,"y":251,"ms":140},{"x":521,"y":274,"ms":46},{"x":382,"y":248,"ms":41},{"x":359,"y":238,"ms":82},{"x":359,"y":235,"ms":2},{"x":469,"y":213,"ms":54},{"x":506,"y":207,"ms":1},{"x":648,"y":190,"ms":27},{"x":209,"y":206,"ms":244},{"x":209,"y":202,"ms":7},{"x":224,"y":190,"ms":14},{"x":362,"y":148,"ms":32},{"x":418,"y":138,"ms":4},{"x":593,"y":123,"ms":26},{"x":760,"y":120,"ms":23},{"x":825,"y":129,"ms":27},{"x":832,"y":134,"ms":23},{"x":829,"y":149,"ms":23},{"x":711,"y":223,"ms":44},{"x":453,"y":259,"ms":26},{"x":279,"y":253,"ms":24},{"x":245,"y":237,"ms":26},{"x":450,"y":167,"ms":67},{"x":605,"y":161,"ms":23},{"x":631,"y":166,"ms":6},{"x":645,"y":195,"ms":23},{"x":617,"y":245,"ms":26},{"x":481,"y":292,"ms":22},{"x":330,"y":302,"ms":25},{"x":247,"y":296,"ms":23},{"x":240,"y":289,"ms":23},{"x":250,"y":276,"ms":22},{"x":260,"y":267,"ms":2},{"x":308,"y":249,"ms":22},{"x":457,"y":223,"ms":22},{"x":572,"y":218,"ms":26},{"x":600,"y":228,"ms":21},{"x":603,"y":238,"ms":25},{"x":588,"y":256,"ms":24},{"x":526,"y":276,"ms":21},{"x":445,"y":278,"ms":22},{"x":405,"y":274,"ms":1},{"x":352,"y":262,"ms":22},{"x":340,"y":250,"ms":17},{"x":351,"y":232,"ms":18},{"x":394,"y":215,"ms":18},{"x":526,"y":185,"ms":21},{"x":624,"y":173,"ms":19},{"x":698,"y":171,"ms":21},{"x":690,"y":226,"ms":58},{"x":623,"y":254,"ms":25},{"x":404,"y":261,"ms":35},{"x":240,"y":247,"ms":25},{"x":146,"y":222,"ms":25},{"x":145,"y":215,"ms":23},{"x":145,"y":208,"ms":1},{"x":181,"y":180,"ms":27},{"x":280,"y":132,"ms":24},{"x":413,"y":108,"ms":25},{"x":489,"y":117,"ms":22},{"x":519,"y":140,"ms":23},{"x":548,"y":165,"ms":24},{"x":563,"y":182,"ms":22},{"x":568,"y":191,"ms":1},{"x":576,"y":208,"ms":25},{"x":560,"y":225,"ms":25},{"x":524,"y":240,"ms":16},{"x":409,"y":264,"ms":24},{"x":278,"y":269,"ms":22},{"x":234,"y":260,"ms":20},{"x":225,"y":245,"ms":25},{"x":246,"y":220,"ms":21},{"x":340,"y":183,"ms":23},{"x":495,"y":144,"ms":27},{"x":663,"y":123,"ms":21},{"x":739,"y":129,"ms":25},{"x":755,"y":140,"ms":21},{"x":624,"y":205,"ms":118},{"x":517,"y":205,"ms":24},{"x":452,"y":199,"ms":21},{"x":435,"y":193,"ms":20},{"x":439,"y":182,"ms":22},{"x":492,"y":163,"ms":24},{"x":600,"y":141,"ms":21},{"x":677,"y":137,"ms":17},{"x":678,"y":234,"ms":80},{"x":626,"y":249,"ms":20},{"x":416,"y":254,"ms":22},{"x":232,"y":250,"ms":23},{"x":177,"y":241,"ms":19},{"x":172,"y":235,"ms":21},{"x":223,"y":208,"ms":28},{"x":370,"y":169,"ms":23},{"x":489,"y":148,"ms":15},{"x":636,"y":136,"ms":23},{"x":675,"y":144,"ms":22},{"x":677,"y":148,"ms":9},{"x":672,"y":164,"ms":24},{"x":618,"y":192,"ms":22},{"x":584,"y":201,"ms":8},{"x":512,"y":210,"ms":21},{"x":419,"y":210,"ms":24},{"x":404,"y":208,"ms":8},{"x":398,"y":199,"ms":23},{"x":426,"y":183,"ms":22},{"x":453,"y":176,"ms":9},{"x":601,"y":152,"ms":20},{"x":748,"y":221,"ms":81},{"x":732,"y":234,"ms":10},{"x":629,"y":261,"ms":27},{"x":541,"y":263,"ms":24},{"x":531,"y":263,"ms":5},{"x":530,"y":260,"ms":22},{"x":557,"y":241,"ms":26},{"x":890,"y":142,"ms":55},{"x":914,"y":146,"ms":24},{"x":831,"y":234,"ms":58},{"x":730,"y":265,"ms":26},{"x":683,"y":267,"ms":0},{"x":577,"y":267,"ms":22},{"x":456,"y":251,"ms":21},{"x":436,"y":239,"ms":23},{"x":436,"y":232,"ms":21},{"x":455,"y":204,"ms":22},{"x":495,"y":179,"ms":19},{"x":528,"y":164,"ms":1},{"x":615,"y":141,"ms":20},{"x":793,"y":139,"ms":20},{"x":805,"y":233,"ms":55},{"x":764,"y":251,"ms":18},{"x":598,"y":261,"ms":22},{"x":416,"y":256,"ms":19},{"x":258,"y":239,"ms":20},{"x":194,"y":226,"ms":1},{"x":117,"y":202,"ms":20},{"x":92,"y":181,"ms":24},{"x":281,"y":115,"ms":71},{"x":350,"y":111,"ms":24},{"x":398,"y":127,"ms":26},{"x":442,"y":150,"ms":20},{"x":506,"y":199,"ms":26},{"x":543,"y":253,"ms":21},{"x":552,"y":277,"ms":23},{"x":544,"y":301,"ms":23},{"x":492,"y":303,"ms":22},{"x":357,"y":273,"ms":27},{"x":319,"y":261,"ms":1},{"x":271,"y":239,"ms":21},{"x":254,"y":218,"ms":23},{"x":269,"y":191,"ms":22},{"x":339,"y":160,"ms":23},{"x":476,"y":149,"ms":27},{"x":606,"y":171,"ms":22},{"x":648,"y":203,"ms":28},{"x":667,"y":232,"ms":19},{"x":683,"y":252,"ms":23},{"x":696,"y":257,"ms":23},{"x":704,"y":251,"ms":23},{"x":711,"y":244,"ms":4},{"x":742,"y":217,"ms":25},{"x":851,"y":156,"ms":45},{"x":874,"y":141,"ms":22},{"x":880,"y":139,"ms":1},{"x":880,"y":138,"ms":25},{"x":874,"y":137,"ms":24},{"x":848,"y":143,"ms":25},{"x":613,"y":216,"ms":65},{"x":492,"y":251,"ms":21},{"x":453,"y":257,"ms":20},{"x":438,"y":259,"ms":20},{"x":437,"y":257,"ms":53},{"x":435,"y":253,"ms":19},{"x":435,"y":250,"ms":19},{"x":435,"y":249,"ms":18},{"x":433,"y":250,"ms":42},{"x":427,"y":254,"ms":1},{"x":395,"y":270,"ms":24},{"x":378,"y":276,"ms":1},{"x":296,"y":298,"ms":23},{"x":175,"y":316,"ms":26},{"x":106,"y":327,"ms":22},{"x":99,"y":327,"ms":23},{"x":122,"y":308,"ms":28},{"x":219,"y":266,"ms":33},{"x":328,"y":240,"ms":23},{"x":447,"y":234,"ms":29},{"x":473,"y":257,"ms":24},{"x":474,"y":281,"ms":22},{"x":456,"y":334,"ms":22},{"x":445,"y":383,"ms":29},{"x":457,"y":393,"ms":23},{"x":502,"y":382,"ms":24},{"x":560,"y":353,"ms":23},{"x":594,"y":331,"ms":1},{"x":686,"y":283,"ms":22},{"x":807,"y":224,"ms":25},{"x":925,"y":163,"ms":49},{"x":932,"y":162,"ms":21},{"x":937,"y":160,"ms":22},{"x":938,"y":160,"ms":25},{"x":928,"y":166,"ms":42},{"x":766,"y":219,"ms":95},{"x":689,"y":214,"ms":29},{"x":635,"y":211,"ms":27},{"x":620,"y":210,"ms":3},{"x":596,"y":211,"ms":23},{"x":588,"y":213,"ms":1},{"x":580,"y":216,"ms":25},{"x":588,"y":217,"ms":39},{"x":614,"y":217,"ms":17},{"x":633,"y":219,"ms":19},{"x":637,"y":220,"ms":21},{"x":633,"y":229,"ms":19},{"x":583,"y":259,"ms":20},{"x":537,"y":271,"ms":19},{"x":477,"y":276,"ms":21},{"x":444,"y":270,"ms":24},{"x":442,"y":263,"ms":21},{"x":460,"y":239,"ms":26},{"x":480,"y":229,"ms":1},{"x":583,"y":199,"ms":30},{"x":672,"y":195,"ms":26},{"x":677,"y":206,"ms":21},{"x":660,"y":253,"ms":24},{"x":605,"y":296,"ms":23},{"x":526,"y":318,"ms":27},{"x":513,"y":318,"ms":1},{"x":481,"y":316,"ms":23},{"x":465,"y":312,"ms":1},{"x":446,"y":297,"ms":22},{"x":433,"y":272,"ms":24},{"x":427,"y":227,"ms":23},{"x":430,"y":194,"ms":27},{"x":432,"y":199,"ms":43},{"x":435,"y":227,"ms":28},{"x":431,"y":244,"ms":1},{"x":411,"y":276,"ms":22},{"x":397,"y":289,"ms":2},{"x":371,"y":306,"ms":23},{"x":342,"y":307,"ms":22},{"x":330,"y":295,"ms":26},{"x":329,"y":293,"ms":1},{"x":328,"y":283,"ms":22},{"x":377,"y":244,"ms":27},{"x":460,"y":223,"ms":22},{"x":508,"y":216,"ms":1},{"x":615,"y":214,"ms":23},{"x":662,"y":217,"ms":1},{"x":709,"y":235,"ms":21},{"x":708,"y":237,"ms":5},{"x":698,"y":270,"ms":26},{"x":575,"y":304,"ms":21},{"x":407,"y":310,"ms":22},{"x":311,"y":302,"ms":0},{"x":141,"y":279,"ms":24},{"x":20,"y":248,"ms":21},{"x":52,"y":198,"ms":89},{"x":150,"y":186,"ms":23},{"x":286,"y":176,"ms":21},{"x":332,"y":176,"ms":17},{"x":381,"y":186,"ms":18},{"x":409,"y":214,"ms":20},{"x":415,"y":228,"ms":19},{"x":415,"y":246,"ms":22},{"x":415,"y":256,"ms":20},{"x":416,"y":266,"ms":21},{"x":424,"y":268,"ms":26},{"x":462,"y":257,"ms":20},{"x":513,"y":236,"ms":23},{"x":549,"y":220,"ms":1},{"x":665,"y":179,"ms":28},{"x":790,"y":147,"ms":26},{"x":823,"y":141,"ms":2},{"x":880,"y":125,"ms":22},{"x":922,"y":114,"ms":27},{"x":907,"y":117,"ms":41},{"x":863,"y":136,"ms":22},{"x":708,"y":204,"ms":48},{"x":629,"y":215,"ms":27},{"x":551,"y":217,"ms":22},{"x":460,"y":205,"ms":43},{"x":443,"y":204,"ms":25},{"x":442,"y":204,"ms":26},{"x":441,"y":206,"ms":25},{"x":436,"y":209,"ms":23},{"x":430,"y":212,"ms":1},{"x":407,"y":217,"ms":21},{"x":327,"y":248,"ms":27},{"x":277,"y":263,"ms":22},{"x":229,"y":271,"ms":27},{"x":228,"y":271,"ms":23},{"x":239,"y":260,"ms":24},{"x":245,"y":256,"ms":1},{"x":299,"y":233,"ms":21},{"x":439,"y":194,"ms":21},{"x":622,"y":157,"ms":22},{"x":733,"y":220,"ms":92},{"x":734,"y":235,"ms":21},{"x":737,"y":241,"ms":18},{"x":746,"y":248,"ms":20},{"x":758,"y":251,"ms":20},{"x":794,"y":244,"ms":20},{"x":992,"y":154,"ms":66},{"x":1019,"y":145,"ms":20},{"x":1021,"y":148,"ms":45},{"x":739,"y":219,"ms":70},{"x":621,"y":221,"ms":26},{"x":531,"y":223,"ms":23},{"x":509,"y":223,"ms":20},{"x":507,"y":220,"ms":23},{"x":536,"y":205,"ms":24},{"x":595,"y":195,"ms":23},{"x":622,"y":201,"ms":25},{"x":610,"y":227,"ms":21},{"x":547,"y":270,"ms":29},{"x":526,"y":279,"ms":1},{"x":458,"y":296,"ms":24},{"x":408,"y":298,"ms":24},{"x":378,"y":297,"ms":21},{"x":350,"y":292,"ms":21},{"x":350,"y":289,"ms":25},{"x":366,"y":260,"ms":21},{"x":414,"y":231,"ms":23},{"x":444,"y":214,"ms":1},{"x":515,"y":185,"ms":22},{"x":556,"y":176,"ms":3},{"x":636,"y":166,"ms":30},{"x":664,"y":195,"ms":21},{"x":645,"y":244,"ms":21},{"x":584,"y":296,"ms":23},{"x":533,"y":313,"ms":21},{"x":399,"y":315,"ms":30},{"x":301,"y":312,"ms":22},{"x":285,"y":304,"ms":28},{"x":285,"y":295,"ms":2},{"x":306,"y":265,"ms":21},{"x":380,"y":208,"ms":20},{"x":495,"y":157,"ms":24},{"x":582,"y":148,"ms":21},{"x":632,"y":148,"ms":3},{"x":776,"y":223,"ms":285},{"x":707,"y":245,"ms":6},{"x":518,"y":295,"ms":25},{"x":374,"y":319,"ms":26},{"x":262,"y":324,"ms":25},{"x":224,"y":324,"ms":1},{"x":146,"y":319,"ms":25},{"x":120,"y":318,"ms":21},{"x":98,"y":318,"ms":22},{"x":95,"y":318,"ms":24},{"x":96,"y":317,"ms":21},{"x":120,"y":311,"ms":22},{"x":134,"y":308,"ms":2},{"x":187,"y":301,"ms":22},{"x":318,"y":285,"ms":20},{"x":509,"y":264,"ms":25},{"x":678,"y":270,"ms":26},{"x":727,"y":291,"ms":23},{"x":729,"y":316,"ms":22},{"x":703,"y":344,"ms":22},{"x":666,"y":362,"ms":20},{"x":579,"y":376,"ms":24},{"x":533,"y":384,"ms":21},{"x":551,"y":369,"ms":45},{"x":625,"y":327,"ms":20},{"x":673,"y":299,"ms":19},{"x":741,"y":264,"ms":22},{"x":758,"y":241,"ms":24},{"x":753,"y":227,"ms":22},{"x":724,"y":212,"ms":22},{"x":703,"y":210,"ms":22},{"x":661,"y":223,"ms":22},{"x":575,"y":270,"ms":21},{"x":465,"y":328,"ms":23},{"x":427,"y":359,"ms":19},{"x":417,"y":374,"ms":19},{"x":421,"y":382,"ms":19},{"x":428,"y":383,"ms":20},{"x":440,"y":383,"ms":19},{"x":451,"y":383,"ms":0},{"x":489,"y":380,"ms":20},{"x":547,"y":372,"ms":19},{"x":603,"y":362,"ms":1},{"x":693,"y":338,"ms":17},{"x":762,"y":307,"ms":18},{"x":815,"y":272,"ms":20},{"x":823,"y":260,"ms":19},{"x":794,"y":263,"ms":23},{"x":707,"y":294,"ms":25},{"x":608,"y":331,"ms":25},{"x":582,"y":347,"ms":22},{"x":582,"y":349,"ms":28},{"x":601,"y":337,"ms":22},{"x":634,"y":305,"ms":21},{"x":648,"y":282,"ms":26},{"x":648,"y":279,"ms":23},{"x":611,"y":294,"ms":24},{"x":572,"y":314,"ms":22},{"x":543,"y":329,"ms":1},{"x":516,"y":344,"ms":23},{"x":511,"y":347,"ms":1},{"x":503,"y":351,"ms":23},{"x":502,"y":352,"ms":23},{"x":529,"y":345,"ms":47},{"x":591,"y":325,"ms":23},{"x":629,"y":305,"ms":25},{"x":631,"y":303,"ms":26},{"x":616,"y":312,"ms":23},{"x":559,"y":330,"ms":20},{"x":446,"y":336,"ms":26},{"x":355,"y":321,"ms":23},{"x":321,"y":309,"ms":23},{"x":321,"y":301,"ms":22},{"x":327,"y":294,"ms":22},{"x":386,"y":282,"ms":27},{"x":418,"y":281,"ms":22},{"x":450,"y":281,"ms":21},{"x":472,"y":282,"ms":25},{"x":476,"y":284,"ms":22},{"x":472,"y":290,"ms":45},{"x":453,"y":302,"ms":20},{"x":403,"y":324,"ms":20},{"x":374,"y":331,"ms":20},{"x":368,"y":333,"ms":21},{"x":369,"y":333,"ms":20},{"x":396,"y":329,"ms":18},{"x":422,"y":327,"ms":1},{"x":504,"y":321,"ms":19},{"x":610,"y":308,"ms":19},{"x":751,"y":297,"ms":18},{"x":779,"y":295,"ms":19},{"x":789,"y":295,"ms":20},{"x":789,"y":299,"ms":23},{"x":760,"y":321,"ms":27},{"x":682,"y":348,"ms":24},{"x":547,"y":366,"ms":27},{"x":425,"y":358,"ms":20},{"x":385,"y":345,"ms":20},{"x":357,"y":320,"ms":26},{"x":348,"y":287,"ms":21},{"x":346,"y":264,"ms":25},{"x":348,"y":253,"ms":22},{"x":377,"y":247,"ms":22},{"x":450,"y":241,"ms":24},{"x":497,"y":236,"ms":0},{"x":549,"y":232,"ms":21},{"x":597,"y":237,"ms":21},{"x":606,"y":253,"ms":24},{"x":599,"y":291,"ms":23},{"x":563,"y":328,"ms":23},{"x":490,"y":346,"ms":25},{"x":380,"y":338,"ms":23},{"x":298,"y":312,"ms":29},{"x":278,"y":293,"ms":28},{"x":303,"y":273,"ms":23},{"x":347,"y":256,"ms":23},{"x":465,"y":225,"ms":22},{"x":604,"y":205,"ms":22},{"x":697,"y":212,"ms":21},{"x":719,"y":236,"ms":24},{"x":717,"y":261,"ms":21},{"x":671,"y":296,"ms":24},{"x":536,"y":311,"ms":25},{"x":343,"y":297,"ms":24},{"x":247,"y":264,"ms":27},{"x":254,"y":251,"ms":25},{"x":314,"y":233,"ms":24},{"x":432,"y":213,"ms":26},{"x":553,"y":204,"ms":21},{"x":587,"y":207,"ms":19},{"x":603,"y":219,"ms":19},{"x":608,"y":227,"ms":1},{"x":607,"y":248,"ms":18},{"x":580,"y":268,"ms":19},{"x":485,"y":280,"ms":23},{"x":346,"y":272,"ms":20},{"x":278,"y":257,"ms":19},{"x":256,"y":242,"ms":18},{"x":281,"y":209,"ms":27},{"x":347,"y":189,"ms":22},{"x":492,"y":175,"ms":23},{"x":601,"y":193,"ms":27},{"x":614,"y":202,"ms":22},{"x":620,"y":216,"ms":24},{"x":600,"y":236,"ms":21},{"x":446,"y":261,"ms":28},{"x":235,"y":260,"ms":24},{"x":183,"y":241,"ms":27},{"x":200,"y":229,"ms":20},{"x":299,"y":207,"ms":22},{"x":437,"y":193,"ms":24},{"x":598,"y":191,"ms":22},{"x":666,"y":199,"ms":21},{"x":690,"y":206,"ms":1},{"x":717,"y":228,"ms":24},{"x":713,"y":244,"ms":22},{"x":613,"y":266,"ms":25},{"x":529,"y":266,"ms":1},{"x":352,"y":247,"ms":23},{"x":212,"y":217,"ms":21},{"x":229,"y":198,"ms":24},{"x":264,"y":187,"ms":21}]]

var PokemonGo = function(div, opts){
    var _size = {w: 1024, h: 608};
    var world, sphereBody, cylinderBody, pokemon, ball, pokemon_texture, ball_texture;
    var dt = 1 / 60;
    var touch = (location.href.indexOf('touch') != - 1 ? true: false);
    var camera, scene, renderer, gplane = false, container, projector;
    var geometry, material, mesh, ballMaterial;
    var controls;
    var jointBody, constrainedBody, mouseConstraint;
    var ballSize = 0.6;
    var states = {
        is_active: opts.is_active || false,
        cylinder_mode: false,
        start_collision: false,
        collision: false,
        gotcha: false,
        throwed: false,
        constraintDown: false
    };
    var $ball_boom, $div;
    // To be synced
    var meshes = [], bodies = [];
    var handler;

    var that = this;
    that.$div = $div = $(div);
    that.pokemon_texture = pokemon_texture = [];
    that.ball_texture = ball_texture = [];
    that.current_pokemon_id = that.current_ball_id = 0;
    that.states = states;

    function init() {

        projector = new THREE.Projector();

        container = document.createElement('div');
        $div.append(container);
        $(container).attr('id', 'pokemon');

        // scene
        scene = new THREE.Scene();
        scene.fog = new THREE.Fog(0xFF8300, 500, 10000);

        // camera
        that.camera = camera = new THREE.PerspectiveCamera(20, _size.w / _size.h, 0.01, 1000);
        camera.position.set(10, 10, 0);
        camera.quaternion.setFromAxisAngle(new THREE.Vector3(0, 1, 0), Math.PI / 2);
        scene.add(camera);

        // lights
        var light, materials;
        scene.add(new THREE.AmbientLight(0x666666));

        light = new THREE.DirectionalLight(0xffffff, 1.75);
        var d = 20;

        light.position.set(d, d, d);

        light.castShadow = true;
        //light.shadowCameraVisible = true;
        light.shadow.mapSize.width = 1024;
        light.shadow.mapSize.height = 1024;

        light.shadow.camera.left = - d;
        light.shadow.camera.right = d;
        light.shadow.camera.top = d;
        light.shadow.camera.bottom = - d;

        light.shadow.camera.far = 3 * d;
        light.shadow.camera.near = d;

        scene.add(light);

        // floor
        geometry = new THREE.PlaneGeometry(200, 200, 5, 5);
        //geometry.applyMatrix( new THREE.Matrix4().makeRotationX( -Math.PI / 2 ) );
        var texture = new THREE.TextureLoader().load('images/grass.png');
        texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
        texture.repeat.set(5, 5);
        material = new THREE.MeshBasicMaterial({
            map: texture,
            side: THREE.DoubleSide
        });
        markerMaterial = new THREE.MeshLambertMaterial({
            color: 0xff0000
        });
        //THREE.ColorUtils.adjustHSV( material.color, 0, 0, 0.9 );
        mesh = new THREE.Mesh(geometry, material);
        mesh.castShadow = true;
        mesh.quaternion.setFromAxisAngle(new THREE.Vector3(1, 0, 0), - Math.PI / 2);
        mesh.receiveShadow = true;
        scene.add(mesh);
        // sphere
        ballGeo = new THREE.SphereGeometry(ballSize, 20, 20);
        ballMaterial = new THREE.MeshPhongMaterial({
            color: 0x888888
        });
        opts.ball.forEach(function(d){
            ball_texture.push( new THREE.TextureLoader().load('images/'+d) );
        });
        ballMaterial.map = ball_texture[that.current_ball_id];

        sphereMesh = new THREE.Mesh(ballGeo, ballMaterial);
        sphereMesh.castShadow = true;
        //sphereMesh.receiveShadow = true;
        that.ball = ball = sphereMesh;
        meshes.push(sphereMesh);
        scene.add(sphereMesh);

        renderer = new THREE.WebGLRenderer({
            antialias: true,
            alpha: true
        });
        renderer.setSize(_size.w, _size.h);
        //renderer.setClearColor( 0xffffff, 0 );
        renderer.setClearColor(0x000000, 0); // the default
        container.appendChild(renderer.domElement);

        renderer.gammaInput = true;
        renderer.gammaOutput = true;
        renderer.shadowMap.enabled = true;

        (function(scene) {
            var material;
            var f = 0.04, w = 100 * f, h = 116 * f;
            opts.pokemon.forEach(function(d){
                pokemon_texture.push({
                    normal: new THREE.TextureLoader().load("images/"+d.normal),
                    hit: new THREE.TextureLoader().load("images/"+d.hit)
                });
            });
            material = new THREE.MeshBasicMaterial({
                map: pokemon_texture[that.current_pokemon_id].normal,
                side: THREE.DoubleSide,
                transparent: true
            });
            plane = new THREE.Mesh(new THREE.PlaneGeometry(w, h), material);
            plane.doubleSided = true;
            plane.position.set( - 15, h / 2, 0); // Not sure what this number represents.
            plane.rotation.set(0, Math.PI / 2, 0); // Not sure what this number represents.
            if (states.cylinder_mode) {
                var cylinder = new THREE.Mesh(new THREE.CylinderGeometry(w / 2, w / 2, h, 18, 3), markerMaterial);
                scene.add(cylinder);
                that.pokemon = pokemon = cylinder;
                meshes.push(cylinder);
            } else {
                scene.add(plane);
                that.pokemon = pokemon = plane;
                meshes.push(plane);
            }
            var cylinderShape = new CANNON.Cylinder(w / 2, w / 2, h, 20);
            var mat = new CANNON.Material();
            var mat_g = new CANNON.ContactMaterial(groundBody.material, mat, {
                friction: 3,
                restitution: 0.5
            });
            that.cylinderBody = cylinderBody = new CANNON.Body({
                mass: 5,
                material: mat
            });
            cylinderBody.addShape(cylinderShape);
            cylinderBody.position.set( - 15, h / 2 + 10, 0);
            cylinderBody.addEventListener("collide", function(e) {
                if (e.body.index == 0) {
                    pokemon.material.map = pokemon_texture[that.current_pokemon_id].hit;
                    if(!states.start_collision) {
                        states.start_collision = true;
                        setTimeout(function() {
                            states.collision = true;
                        },
                        1000);
                        setTimeout(function() {
                            states.gotcha = true;
                            var pos = get2DPos(ball.position, camera, renderer.domElement);
                            ball.visible = false;
                            $ball_boom.show().offset({left: pos.x, top: pos.y}).toggleClass('animation_toggle');
                        },
                        2000);
                    }
                }
            });
            world.addContactMaterial(mat_g);
            world.add(cylinderBody);
            bodies.push(cylinderBody);
        })(scene);

        if (touch) {
            container.addEventListener("touchmove", onMouseMove, false);
            container.addEventListener("touchstart", onMouseDown, false);
            container.addEventListener("touchend", onMouseUp, false);
        } else {
            container.addEventListener("mousemove", onMouseMove, false);
            container.addEventListener("mousedown", onMouseDown, false);
            container.addEventListener("mouseup", onMouseUp, false);
            /*
            var container2 = $('.toucharea')[0];
            container2.addEventListener("mousemove", fakeTouchHandler.move, false);
            container2.addEventListener("mousedown", fakeTouchHandler.down, false);
            container2.addEventListener("mouseup", fakeTouchHandler.up, false);
            */
        }
        //controls = new THREE.OrbitControls(camera, renderer.domElement);
    }


    that.handler = handler = {
        mousedown: function(x, y) {
            /*
            PokemonGoMouseGesture.splice(0,0,[{
                previous_time: (new Date()).getTime(),
                x: x, y: y,
                ball_pos: {
                    x: ball.position.x,
                    y: ball.position.y,
                    z: ball.position.z
                }
            }]);
            */
            // Find mesh from a ray
            var entity = findNearestIntersectingObject(x, y, camera, meshes);
            var pos = entity.point;
            if (pos && entity.object.geometry instanceof THREE.SphereGeometry) {
                states.constraintDown = true;

                // Set the movement plane
                setScreenPerpCenter(pos, camera);

                var idx = meshes.indexOf(entity.object);
                if (idx !== - 1) {
                    addMouseConstraint(pos.x, pos.y, pos.z, bodies[idx]);
                }
            }
        },
        mousemove: function(x, y) {
            // Move and project on the plane
            if (gplane && mouseConstraint) {
                /*
                PokemonGoMouseGesture[0].push({
                    x: x, y: y,
                    ms: ((new Date()).getTime() - PokemonGoMouseGesture[0][0].previous_time)
                });
                PokemonGoMouseGesture[0][0].previous_time = (new Date()).getTime();
                */
                // ray only intersects 'visible' object
                var orig = gplane.visible;
                gplane.visible = true;
                var pos = projectOntoPlane(x, y, gplane, camera);
                gplane.visible = orig; 
                if (pos) {
                    moveJointToPoint(pos.x, pos.y, pos.z);
                }
            }
        },
        mouseup: function() {
            if (gplane && mouseConstraint) {
                states.constraintDown = false;
                states.throwed = true;
                //world.gravity.y = -20;

                // Send the remove mouse joint to server
                removeJointConstraint();

                var shootDirection = new THREE.Vector3();
                var v = sphereBody.velocity;
                getShootDir(shootDirection, v);
                v = Math.sqrt(v.x * v.x + v.y * v.y + v.z * v.z) * 1.3;
                v = (v > 10 ? 10: v) * 5;
                //console.log(shootDirection.y * v / 4);
                sphereBody.velocity.set(
                shootDirection.x * v, (shootDirection.y * v / 4) > 6 ? 6: (shootDirection.y * v / 4), shootDirection.z * v * 3);
                //console.log(sphereBody.velocity.y);
                world.defaultContactMaterial.restitution = 0.9;
            }
        }
    };
    function onMouseDown(e) {
        e.preventDefault();
        e.stopPropagation();
        e = e.touches && e.touches[0] || e;
        var offset = $('#pokemon').offset();
        handler.mousedown(e.clientX - offset.left, e.clientY - offset.top);
        return false;
    }
    function onMouseMove(e) {
        e.preventDefault();
        e.stopPropagation();
        e = e.touches && e.touches[0] || e;
        var offset = $('#pokemon').offset();
        handler.mousemove(e.clientX - offset.left, e.clientY - offset.top);
        return false;
    }

    function onMouseUp(e) {
        handler.mouseup();
        return false;
    }
    that.fakeTouchHandler = (function() {
        var x0, y0;
        return {
            down: function(e) {
                e.preventDefault && e.preventDefault();
                e.stopPropagation && e.stopPropagation();
                e = e.touches && e.touches[0] || e;
                var offset = $('#pokemon').offset();
                var pos_self = {
                    x: e.clientX,
                    y: e.clientY
                };
                var pos0 = get2DPos(meshes[0].position, camera, renderer.domElement);
                x0 = pos0.x - pos_self.x;
                y0 = pos0.y - pos_self.y;
                handler.mousedown(pos_self.x + x0 - offset.left, pos_self.y + y0 - offset.top);
                return false;
            },
            move: function(e) {
                e.preventDefault && e.preventDefault();
                e.stopPropagation && e.stopPropagation();
                e = e.touches && e.touches[0] || e;
                var offset = $('#pokemon').offset();
                var pos_self = {
                    x: e.clientX,
                    y: e.clientY
                };
                handler.mousemove(pos_self.x + x0 - offset.left, pos_self.y + y0 - offset.top);
                return false;
            },
            up: function() {
                x0 = y0 = 0;
                handler.mouseup();
                return false;
            }
        };
    })();

    // This function creates a virtual movement plane for the mouseJoint to move in
    function setScreenPerpCenter(point, camera) {
        // If it does not exist, create a new one
        if (!gplane) {
            var planeGeo = new THREE.PlaneGeometry(100, 100);
            var plane = gplane = new THREE.Mesh(planeGeo, material);
            plane.visible = false; // Hide it..
            scene.add(gplane);
        }

        // Center at mouse position
        gplane.position.copy(point);

        // Make it face toward the camera
        gplane.quaternion.copy(camera.quaternion);
    }

    var lastx, lasty, last;
    function projectOntoPlane(screenX, screenY, thePlane, camera) {
        var x = screenX;
        var y = screenY;
        var now = new Date().getTime();
        // project mouse to that plane
        var hit = findNearestIntersectingObject(screenX, screenY, camera, [thePlane]);
        lastx = x;
        lasty = y;
        last = now;
        if (hit) return hit.point;
        return false;
    }
    function new_findNearestIntersectingObject(clientX, clientY, camera, objects) {

        console.log(clientX, clientY);

        var mouse3D = new THREE.Vector3(0,0,0), raycaster = new THREE.Raycaster();
        mouse3D.x = (clientX / _size.w) * 2 - 1;
        mouse3D.y = - (clientY / _size.h) * 2 + 1;
        mouse3D.z = 0.5;

        mouse3D.unproject( camera );
        raycaster.set( camera.position, mouse3D.sub( camera.position ).normalize() );

        var hits = raycaster.intersectObjects( objects);

        var closest = false;
        if (hits.length > 0) {
            closest = hits[0];
        }

        return closest;
    }
    function findNearestIntersectingObject(clientX, clientY, camera, objects) {
        // Get the picking ray from the point
        var raycaster = getRayCasterFromScreenCoord(clientX, clientY, camera);

        // Find the closest intersecting object
        // Now, cast the ray all render objects in the scene to see if they collide. Take the closest one.
        var hits = raycaster.intersectObjects(objects);
        var closest = false;
        if (hits.length > 0) {
            closest = hits[0];
        }

        return closest;
    }
    function getRayCasterFromScreenCoord(screenX, screenY, camera) {
        var mouse2D = new THREE.Vector2();
        // Get 2D point form the client x y
        mouse2D.x = (screenX / _size.w) * 2 - 1;
        mouse2D.y = - (screenY / _size.h) * 2 + 1;
        var raycaster = new THREE.Raycaster();
        raycaster.setFromCamera(mouse2D, camera);
        return raycaster;
    }

    that.animate = function() {
        if (states.is_active) requestAnimationFrame(that.animate);
        if (!states.gotcha) {
            if (camera.position.y > 2) camera.position.y -= 0.1;
            //controls.update();
            updatePhysics();
            render();
        } else {
            if ((Math.abs(ball.position.x - pokemon.position.x) + Math.abs(ball.position.y - pokemon.position.y) + Math.abs(ball.position.z - pokemon.position.z)) > 0.0001) {
                pokemon.position.x += (ball.position.x - pokemon.position.x) * 0.12;
                pokemon.position.y += (ball.position.y - pokemon.position.y) * 0.12;
                pokemon.position.z += (ball.position.z - pokemon.position.z) * 0.12;
            }
            if (pokemon.scale.x > 0.0001) {
                pokemon.scale.x *= 0.90;
                pokemon.scale.y *= 0.90;
                pokemon.scale.z *= 0.90;
            }
            render();
        }
    };

    function updatePhysics() {
        world.step(dt);
        for (var i = 0; i !== meshes.length; i++) {
            meshes[i].position.copy(bodies[i].position);
            if (!states.cylinder_mode && i == 1){
                meshes[i].position.y += 0.2;
            }
            if (states.cylinder_mode || i < 1){
                meshes[i].quaternion.copy(bodies[i].quaternion);
            }
            if (states.collision) {
                if (world.gravity.y > - 100) world.gravity.y -= 1;
            }
        }
    }

    function render() {
        renderer.render(scene, camera);
    }

    function initCannon() {
        // Setup our world
        that.world = world = new CANNON.World();
        world.quatNormalizeSkip = 0;
        world.quatNormalizeFast = false;

        world.gravity.set(0, - 10, 0);
        world.broadphase = new CANNON.NaiveBroadphase();
        world.defaultContactMaterial.restitution = 1;
        world.defaultContactMaterial.friction = 0;

        var mass = 5;
        // Create sphere
        var sphereShape = new CANNON.Sphere(ballSize);
        that.sphereBody = sphereBody = new CANNON.Body({
            mass: mass
        });
        sphereBody.addShape(sphereShape);
        sphereBody.position.set(0, 3, 0);
        sphereBody.addEventListener("collide", function(e) {
            if (states.throwed) {
                world.gravity.set(0, - 60, 0);
                sphereBody.velocity.x *= 0.9;
                sphereBody.velocity.y *= 0.9;
                sphereBody.velocity.z *= 0.9;
                sphereBody.angularVelocity.x *= 0.6;
                sphereBody.angularVelocity.y *= 0.6;
                sphereBody.angularVelocity.z *= 0.6;
            }
        });
        sphereBody.angularVelocity.set(0, 3, 10);

        world.add(sphereBody);
        bodies.push(sphereBody);

        // Create a plane
        var groundShape = new CANNON.Plane();
        groundBody = new CANNON.Body({
            mass: 0,
            material: new CANNON.Material()
        });
        groundBody.addShape(groundShape);
        groundBody.quaternion.setFromAxisAngle(new CANNON.Vec3(1, 0, 0), - Math.PI / 2);
        world.add(groundBody);

        // Joint body
        var shape = new CANNON.Sphere(0.1);
        jointBody = new CANNON.Body({
            mass: 0
        });
        jointBody.addShape(shape);
        jointBody.collisionFilterGroup = 0;
        jointBody.collisionFilterMask = 0;
        world.add(jointBody)
    }

    function addMouseConstraint(x, y, z, body) {
        // The cannon body constrained by the mouse joint
        constrainedBody = body;

        // Vector to the clicked point, relative to the body
        var v1 = new CANNON.Vec3(x, y, z).vsub(constrainedBody.position);

        // Apply anti-quaternion to vector to tranform it into the local body coordinate system
        var antiRot = constrainedBody.quaternion.inverse();
        pivot = antiRot.vmult(v1); // pivot is not in local body coordinates
        // Move the cannon click marker particle to the click position
        jointBody.position.set(x, y, z);

        // Create a new constraint
        // The pivot for the jointBody is zero
        if (mouseConstraint) {
            world.removeConstraint(mouseConstraint);
        }
        mouseConstraint = new CANNON.PointToPointConstraint(constrainedBody, pivot, jointBody, new CANNON.Vec3(0, 0, 0));

        // Add the constriant to world
        world.addConstraint(mouseConstraint);
    }

    // This functions moves the transparent joint body to a new postion in space
    function moveJointToPoint(x, y, z) {
        // Move the joint body to a new position
        jointBody.position.set(x, y, z);
        mouseConstraint.update();
    }

    function removeJointConstraint() {
        // Remove constriant from world
        world.removeConstraint(mouseConstraint);
        mouseConstraint = false;
    }

    function getShootDir(targetVec, v) {
        var vector = targetVec;
        targetVec.set(0, v.y, 1);
        //projector.unprojectVector(vector, camera);
        vector.unproject(camera);
        var ray = new THREE.Ray(sphereBody.position, vector.sub(sphereBody.position).normalize());
        targetVec.x = ray.direction.x;
        targetVec.y = ray.direction.y;
        targetVec.z = ray.direction.z;
    }
    function get2DPos(p, camera, div) {
        var pos = new THREE.Vector3(p.x, p.y, p.z);
        projScreenMat = new THREE.Matrix4();
        projScreenMat.multiplyMatrices(camera.projectionMatrix, camera.matrixWorldInverse);
        pos.applyProjection(projScreenMat);
        var offset = findOffset(div);
        return {
            x: (pos.x + 1) * div.width / 2 + offset.left,
            y: ( - pos.y + 1) * div.height / 2 + offset.top
        };

    }
    function findOffset(element) {
        var pos = new Object();
        pos.left = pos.top = 0;
        if (element.offsetParent) {
            do {
                pos.left += element.offsetLeft;
                pos.top += element.offsetTop;
            } while (element = element.offsetParent);
        }
        return pos;
    }
    $(function() {
        $div.find('.reset-area').click(function(){
            that.resetBall();
            that.setBall();
        });
        $ball_boom = $div.find('.boom_outer').hide().bind('animationend', function(e){
                        e.stopPropagation();
                        $ball_boom.hide();
                        ball.visible = true;
                        pokemon.visible = false;
                        $div.trigger('gotcha');
                    });
        initCannon();
        init();
        that.animate();
    });
};
PokemonGo.prototype = {
    constructor: PokemonGo,
    setActive: function(is_active){
        var that = this;
        if(is_active != that.states.is_active) {
            that.states.is_active = is_active;
            if(is_active) {
                that.animate();
            }
        }
    },
    _worldReset: function(){
        var that = this;
        var world = that.world;
        world.defaultContactMaterial.restitution = 1;
        world.defaultContactMaterial.friction = 0;
        world.gravity.y = - 10;
    },
    _ballReset: function(){
        var that = this;
        var sphereBody = that.sphereBody;
        sphereBody.velocity.set(0, 0, 0);
        sphereBody.angularVelocity.set(0, 3, 10);
        sphereBody.position.set(0, 3, 0);
        sphereBody.quaternion.set(0, 0, 0, 1);
    },
    _statesReset: function(){
        var that = this;
        var states = that.states;
        states.collision = false;
        states.gotcha = false;
        states.throwed = false;
        states.start_collision = false;
    },
    resetAll: function(){
        var that = this;
        var camera = that.camera, pokemon = that.pokemon, pokemon_texture = that.pokemon_texture;
        var cylinderBody = that.cylinderBody;
        var f = 0.04, w = 100 * f, h = 116 * f;
        camera.position.y = 4.5;
        that._worldReset();
        that._statesReset();

        cylinderBody.velocity.set(0, 0, 0);
        cylinderBody.angularVelocity.set(0, 0, 0);
        cylinderBody.position.set( - 15, h / 2 + 10, 0);
        cylinderBody.quaternion.set(0, 0, 0, 1);
        pokemon.scale.set(1, 1, 1);
        pokemon.visible = true;
        pokemon.material.map = pokemon_texture[that.current_pokemon_id].normal;

        that._ballReset();
    },
    resetBall: function(){
        var that = this;
        that._worldReset();
        that._statesReset();
        that._ballReset();
    },
    setPokemon: function(pokemon_id){
        var that = this;
        var pokemon_texture = that.pokemon_texture;
        if(pokemon_id === undefined) {
            pokemon_id = parseInt(Math.random()*pokemon_texture.length, 10);
        }
        if(pokemon_id != that.current_pokemon_id && pokemon_texture[pokemon_id]) {
            that.$div.attr('data-pokemon-id', pokemon_id);
            that.current_pokemon_id = pokemon_id;
            that.pokemon.material.map = pokemon_texture[that.current_pokemon_id].normal;
        }
    },
    setBall: function(ball_id){
        var that = this;
        var ball_texture = that.ball_texture;
        if(ball_id === undefined) {
            ball_id = parseInt(Math.random()*ball_texture.length, 10);
        }
        if(ball_id != that.current_ball_id && ball_texture[ball_id]) {
            that.$div.attr('data-ball-id', ball_id);
            that.current_ball_id = ball_id;
            that.ball.material.map = ball_texture[that.current_ball_id];
        }
    },
    replayLog: (function(){
        var timer;
        return function(log){
            var that = this, sphereBody = that.sphereBody, ball = that.ball, handler = that.handler;

            ball.position.set(
                log[0].ball_pos.x,
                log[0].ball_pos.y,
                log[0].ball_pos.z
            );
            sphereBody.position.set(
                log[0].ball_pos.x,
                log[0].ball_pos.y,
                log[0].ball_pos.z
            );
            sphereBody.velocity.set(0,0,0);
            setTimeout(function(){
                handler.mousedown(log[0].x, log[0].y);
                (function process(i){
                    if(log[i]) {
                        clearTimeout(timer);
                        timer = setTimeout(function(){
                            handler.mousemove(log[i].x, log[i].y);
                            process(i+1);
                        }, log[i].ms);
                    } else {
                        handler.mouseup();
                    }
                })(1);
            }, 100);
        }
    })()
};

